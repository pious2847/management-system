<!DOCTYPE html>
<html lang="en">

<%- include('./layouts/header') %>

    <body>

        <div class="container-fluid">
            <div class="row ">

                <%- include('./layouts/sidebar') %>
                    <!-- Mobile Overlay -->
                    <div class="mobile-overlay"></div>
                    <div class="main-content p-3">
                        <%- include('./layouts/topnav') %>


                            <div class="content-wrapper my-5">

                                <div class="welcome mb-4 mt-5">
                                    <h4 class="text-primary font-monospace">Materials</h4>
                                    <p class="small">A brief summary of organization materials records </p>
                                </div>
                               
                                <div class="table-responsive p-2">
                                    <table class="table table-striped table-hover table-responsive-stack" id="materialsTable">
                                        <thead>
                                            <tr>
                                                <th class="text-center">
                                                    <input type="checkbox" id="selectAllCheckbox" class="form-check-input p-0 position-relative">
                                                </th>
                                                <th>Material Name</th>
                                                <th>Weight</th>
                                                <th>Stock</th>
                                                <th>Unit Price</th>
                                                <th>Description</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% materials.forEach(function(material, index) { %>
                                            <tr>
                                                <td data-label="Select" class="text-center">
                                                    <input type="checkbox" class="form-check-input material-checkbox  position-relative" data-id="<%= material.id %>">
                                                </td>
                                                <td data-label="Material Name"><%= material.name %></td>
                                                <td data-label="Weight"><%= material.weight %></td>
                                                <td data-label="Stock"><%= material.stock %></td>
                                                <td data-label="Unit Price">$<%= material.unitPrice.toFixed(2) %></td>
                                                <td data-label="Description"><%= material.description %></td>
                                                <td data-label="Actions">
                                                    <div class="btn-group" role="group">
                                                        <button type="button" class="btn btn-sm btn-primary edit-btn" data-id="<%= material._id %>">
                                                            <i class="bi bi-pencil"></i> Edit
                                                        </button>
                                                        <button type="button" class="btn btn-sm btn-danger delete-btn" data-id="<%= material._id %>">
                                                            <i class="bi bi-trash"></i> Delete
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            <% }); %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                    </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Select All Checkbox functionality
                const selectAllCheckbox = document.getElementById('selectAllCheckbox');
                const materialCheckboxes = document.querySelectorAll('.material-checkbox');
    
                selectAllCheckbox.addEventListener('change', function() {
                    materialCheckboxes.forEach(checkbox => {
                        checkbox.checked = selectAllCheckbox.checked;
                    });
                });
    
                // Edit Button Handler
                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const materialId = this.getAttribute('data-id');
                        // Implement edit logic - redirect or open modal
                        window.location.href = `/materials/edit/${materialId}`;
                    });
                });
    
                // Delete Button Handler
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const materialId = this.getAttribute('data-id');
                        
                        // Confirmation modal
                        if(confirm('Are you sure you want to delete this material?')) {
                            // Implement delete logic
                            fetch(`/materials/delete/${materialId}`, {
                                method: 'DELETE'
                            })
                            .then(response => {
                                if(response.ok) {
                                    // Remove row from table or reload page
                                    this.closest('tr').remove();
                                } else {
                                    alert('Failed to delete material');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('An error occurred while deleting the material');
                            });
                        }
                    });
                });
            });
        </script>
    </body>

</html>